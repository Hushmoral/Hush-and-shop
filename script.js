function doGlobalSearch(evt){ if(evt) evt.preventDefault(); const q=(document.getElementById('globalSearchInput')||{}).value||''; sessionStorage.setItem('hush_search_query', q.trim()); window.location.href='search.html'; return false; } function cartList(){ return JSON.parse(localStorage.getItem('cart')||'[]'); } function saveCart(c){ localStorage.setItem('cart', JSON.stringify(c)); updateCartCount(); renderSidebar(); } function updateCartCount(){ const n = cartList().reduce((a,b)=>a+b.quantity,0); document.querySelectorAll('#cartCount').forEach(el=>el.textContent = n); } function addToCart(id){ const p = PRODUCTS.find(x=>x.id===id); if(!p) return; let c = cartList(); const ex = c.find(i=>i.id===id); if(ex) ex.quantity += 1; else c.push({id:p.id,name:p.name,price:(p.sale_price||p.price),image:p.image,quantity:1}); saveCart(c); alert(p.name + ' added to cart'); } function toggleSidebar(open){ const sb = document.getElementById('cartSidebar'); if(!sb) return; if(open) sb.classList.add('open'), sb.style.right='0'; else sb.classList.remove('open'), sb.style.right='-420px'; } document.addEventListener('click', function(e){ if(e.target && e.target.id==='cartToggle') toggleSidebar(true); }); function renderSidebar(){ const sb = document.getElementById('cartSidebar'); if(!sb) return; const c = cartList(); const area = document.getElementById('cartItemsArea'); area.innerHTML=''; let total=0; c.forEach((it,idx)=>{ const sub = it.price * it.quantity; total += sub; const div = document.createElement('div'); div.className='cart-item'; div.innerHTML = '<img src="'+it.image+'"><div style="flex:1"><div style="font-weight:700">'+it.name+'</div><div>$'+it.price.toFixed(2)+' x '+it.quantity+'</div></div><div><button onclick="removeFromCart('+idx+')" style="background:#d9534f;color:#fff;border:none;padding:6px;border-radius:6px">Remove</button></div>'; area.appendChild(div); }); document.getElementById('cartSubtotal').textContent = '$'+total.toFixed(2); updateCartCount(); } function removeFromCart(idx){ let c = cartList(); c.splice(idx,1); saveCart(c); renderSidebar(); } document.addEventListener('DOMContentLoaded', function(){ updateCartCount(); renderSidebar(); const toggles = document.querySelectorAll('#cartToggle'); toggles.forEach(t=>t.addEventListener('click', ()=>toggleSidebar(true))); const close = document.getElementById('closeSidebar'); if(close) close.addEventListener('click', ()=>toggleSidebar(false)); });